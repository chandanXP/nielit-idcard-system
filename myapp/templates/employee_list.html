<!-- templates/employee_list.html -->
{% load static %}
<html>
<head>
    <title>NIELIT Ropar - Employee List</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>
<body>
    <div id="response-message"></div>

    <div class="container">
        <div class="jumbotron">
            <h1>NIELIT Ropar - Employee List</h1>
        </div>
        <div>
            <table class="table">
                <thead>
                  <tr>
                    <th scope="col">Dept</th>
                    <th scope="col">Name</th>
                    <th scope="col">DOB</th>
                    <th scope="col">ID</th>
                    <th scope="col">Gender</th>
                    <th scope="col">Contact</th>
                    <th scope="col">Email</th>
                    <th scope="col">Job title</th>
                    <th scope="col">Join date</th>
                    <th scope="col">End date</th>
                    <th scope="col">Location</th>
                    <th scope="col">Photo</th>
                    <th scope="col">Action</th>

                  </tr>
                </thead>

                <tbody>
                {% for employee in employees %}
                    <tr>
                        <td scope="col">{{ employee.department }}</td>
                        <td scope="col">{{ employee.name }}</td>
                        <td scope="col">{{ employee.dob }}</td>
                        <td scope="col">{{ employee.employee_id }}</td>
                        <td scope="col">{{ employee.gender }}</td>
                        <td scope="col">{{ employee.contact }}</td>
                        <td scope="col">{{ employee.email }}</td>
                        <td scope="col">{{ employee.job_title }}  </td>
                        <td scope="col">{{ employee.join_date }}</td>
                        <td scope="col">{{ employee.end_date }}</td>
                        <td scope="col">{{ employee.work_location }}</td>
                        <td scope="col">
                            {% if employee.profile_image %}
                            <img src="{{ employee.profile_image.url }}" alt="{{ employee.name }} Profile Image" style="width: 150px; height: 150px; ">
                            {% else %}
                            <p>No profile image available</p>
                              {% endif %}

                        </td>
                        <td scope="col">
                            <a class="btn btn-primary gen_qr" id="{{ employee.employee_id }}" href="#">Release ID Card</a>
                            <a class="btn btn-primary download_card" id="download_card" href="/list/download/">Download</a>
                        </td>s


                    </tr>
                {% endfor %}


                </tbody>
            </table>
        </div>


    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            $(".gen_qr").on("click", function (event) {
                event.preventDefault();  // Prevent the default behavior (i.e., following the link)

                var employeeId = $(this).attr("id");

                fetch("/generate_qr/" + employeeId + "/")
                    .then(response => response.json())
                    .then(data => {
                        $("#response-message").text(data.message);
                    })
                    .catch(error => {
                        $("#response-message").text("Error: " + error);
                    });
            });
        });

        $(document).ready(function () {
            $(".download_card___").on("click", function (event) {
                event.preventDefault();  // Prevent the default behavior (i.e., following the link)

                fetch("download/")
                    .then(response => response.json())
                    .then(data => {
                        $("#response-message").text(data.message);
                    })
                    .catch(error => {
                        $("#response-message").text("Error: " + error);
                        console.log(error);
                    });
            });
        });
    </script>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>
</html>
